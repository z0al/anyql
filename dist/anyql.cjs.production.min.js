"use strict";var e=require("redux-saga/effects"),r=require("reselect"),t=require("redux");function n(){return(n=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function a(e,r){function t(){if(r){var t=r.apply(void 0,arguments);if(!t)throw new Error("prepareAction did not return an object");return n({type:e,payload:t.payload},"meta"in t&&{meta:t.meta},{},"error"in t&&{error:t.error})}return{type:e,payload:arguments.length<=0?void 0:arguments[0]}}return t.toString=function(){return""+e},t.type=e,t}var u="query/fetch",c=a("query/error",function(e,r){return{payload:{query:e,error:r}}}),o="query/cancel",i=a("query/result",function(e,r,t){return{payload:{query:e,data:r,next:t}}}),s=regeneratorRuntime.mark(d);function d(r){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:t=[o];case 1:return n.next=4,e.take(t);case 4:if(n.sent.payload.query.id!==r.id){n.next=10;break}return n.next=9,!0;case 9:return n.abrupt("return",n.sent);case 10:n.next=1;break;case 12:case"end":return n.stop()}},s)}function p(e){return void 0!==e}var l=Array.isArray,f=r.createSelector(function(e){return e.queries},function(e,r){return r},function(e,r){return e[r]}),y=regeneratorRuntime.mark(x);function x(r,t){var n,a,u;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,e.select(function(e){return f(e,r.id)});case 2:return n={next:o.sent.next},o.prev=5,o.next=8,e.race({result:e.call(t,n),cancelled:e.call(d,r)});case 8:if(!(a=o.sent).cancelled){o.next=11;break}return o.abrupt("return");case 11:if(!p((u=a.result).error)){o.next=14;break}throw u.error;case 14:if(!p(u.data)){o.next=17;break}return o.next=17,e.put(i(r,l(u.data)?u.data:[u.data],u.next));case 17:o.next=24;break;case 19:return o.prev=19,o.t0=o.catch(5),o.next=23,e.put(c(r,o.t0));case 23:return o.abrupt("return",o.sent);case 24:case"end":return o.stop()}},y,null,[[5,19]])}function v(r){return regeneratorRuntime.mark(function t(){var n,a,c,o,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=[u],t.next=3,e.actionChannel(n);case 3:a=t.sent;case 4:return t.next=7,e.take(a);case 7:return o=(c=t.sent).payload.query,t.next=11,e.call(r,o);case 11:if(i=t.sent,c.type!==u){t.next=15;break}return t.next=15,e.spawn(x,o,i);case 15:t.next=4;break;case 17:case"end":return t.stop()}},t)})}var q=t.combineReducers({queries:function(e,r){switch(void 0===e&&(e={}),r.type){case u:var t,a=r.payload.query,c=n({},e[a.id])||{};return c.id=a.id,c.loading=!0,c.type=a.type||"query",l(c.dataIds)||(c.dataIds=[]),n({},e,((t={})[a.id]=c,t));case"query/error":var o,i=r.payload,s=i.query,d=i.error,p=n({},e[s.id])||{};return p.error=d,p.loading=!1,n({},e,((o={})[s.id]=p,o));case"query/result":var f,y=r.payload,x=y.query,v=y.data,q=y.next,b=n({},e[x.id])||{};b.loading=!1,b.next=q;var g=v.map(function(e){return e.id});return l(b.dataIds)&&g.push.apply(g,b.dataIds),b.dataIds=Array.from(new Set(g)),n({},e,((f={})[x.id]=b,f))}return e},objects:function(e,r){return void 0===e&&(e={}),e}});exports.createEngine=function(e){return{reducer:q,engine:v(e.resolver)}};
//# sourceMappingURL=anyql.cjs.production.min.js.map
